# Maintenance Run 0002

## Metadata
- **Date**: 2025-12-11
- **Base Commit**: abf667c (after run 0001 merge)
- **PR**: #96
- **Scope**: full (aggressive)

## Changes Since Last Run

```
abf667c Merge branch 'main' of github.com:cluesmith/codev
0d614b7 Merge pull request #95 from cluesmith/builder/maintain-k_5J
759b5e8 CLAUDE.md: emphasize parallel + background for 3-way reviews
97cdd97 MAINTAIN: add documentation pruning task (obsolete content, ~400 line limits)
787da2d MAINTAIN: clarify sources - arch.md from specs/plans, lessons-learned from reviews
de924b8 [Maintain] First maintenance run - update lessons-learned.md
```

**Summary**: Maintenance protocol improvements and run 0001 artifacts.

## Tasks Completed

### Code Hygiene
- [x] Dead code removal - ts-prune run: `getBuildersByStatus`, `getUtil`, `TmuxSession` identified as unused. Kept as utility functions.
- [x] Unused dependencies - depcheck false positive (tsx/typescript used in build).
- [x] Dependency updates - **Fixed**: Upgraded vitest 2.1.9 → 4.0.15 to resolve 5 moderate esbuild/vite vulnerabilities.

### Documentation
- [x] **arch.md rewrite** - Complete rewrite: 1636 → 247 lines. Now reflects `packages/codev/` npm structure.
- [x] **CLAUDE.md pruning** - 712 → 223 lines. Extracted detailed content to `codev/docs/commands/`.
- [x] **AGENTS.md sync** - Synced with CLAUDE.md.
- [x] **README.md pruning** - 490 → 162 lines. Condensed, linked to detailed docs.
- [x] lessons-learned.md - No new reviews to extract.

### Framework
- [x] projectlist.md status - Verified current.

## Changes Made

### arch.md (complete rewrite)
- Removed obsolete `agent-farm/` directory references
- Added `packages/codev/` npm package structure
- Documented `codev`, `af`, `consult` CLI commands
- Added source organization with file purposes
- Documented SQLite state management (local + global DBs)
- Added data flow diagrams (init, spawn, consult)
- Reduced from 60K chars to ~12K chars

### CLAUDE.md (pruned)
- Removed duplicate content covered by `codev/docs/commands/`
- Condensed protocol selection to table format
- Condensed CLI reference to quick reference + doc links
- Removed "Lessons Learned from Test Infrastructure" section (too specific)
- Kept essential: git prohibitions, consultation checkpoints, practices

### README.md (pruned)
- Consolidated installation/prerequisites into single section
- Replaced detailed "AI Agents" section with links to docs
- Condensed "Self-Hosted" section
- Condensed "Agent Farm" to quick reference
- Removed detailed VIBE vs SPIDER breakdown (kept summary table)

### Dependencies
- vitest: 2.1.9 → 4.0.15 (breaking change, tests still pass)
- esbuild/vite vulnerabilities resolved

## Validation

- [x] Tests: 216/216 passing with vitest 4.x
- [x] Build: TypeScript compilation clean
- [x] Audit: 0 vulnerabilities

## Summary

Aggressive maintenance run addressing deferred items from run 0001:

| File | Before | After | Reduction |
|------|--------|-------|-----------|
| arch.md | 1636 lines | 247 lines | 85% |
| CLAUDE.md | 712 lines | 223 lines | 69% |
| README.md | 490 lines | 162 lines | 67% |

All files now under 400 line target. npm vulnerabilities resolved. Tests passing.
